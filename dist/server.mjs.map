{"version":3,"sources":["../src/server/index.ts"],"names":[],"mappings":"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","file":"server.mjs","sourcesContent":["/**\n * Simple HTTP server for receiving context reports\n * Run with: npx claude-context-reporter-server\n */\n\nimport { createServer, IncomingMessage, ServerResponse } from 'http';\nimport { writeFile, mkdir } from 'fs/promises';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\n\nconst DEFAULT_PORT = 9847;\nconst REPORTS_DIR = './reports';\nconst SCREENSHOTS_DIR = './reports/screenshots';\n\n/**\n * Suggest related files based on component path\n */\nfunction suggestRelatedFiles(componentPath: ComponentPathItem[]): Array<{\n  suggestedPath: string;\n  type: string;\n  reason: string;\n}> {\n  const files: Array<{ suggestedPath: string; type: string; reason: string }> = [];\n\n  // Find app components (filter out framework)\n  const appComponents = componentPath.filter(\n    (c) =>\n      !c.name.includes('Router') &&\n      !c.name.includes('Provider') &&\n      !c.name.includes('Boundary') &&\n      !c.name.includes('Root') &&\n      !c.name.includes('Handler') &&\n      !c.name.includes('HotReload') &&\n      !c.name.includes('Suspense')\n  );\n\n  const targetComponent = appComponents[appComponents.length - 1];\n  const parentComponent = appComponents[appComponents.length - 2];\n\n  if (targetComponent) {\n    // If we have source location, use it\n    if (targetComponent.sourceLocation) {\n      files.push({\n        suggestedPath: targetComponent.sourceLocation.fileName,\n        type: 'component',\n        reason: 'Selected component (from debug source)',\n      });\n    } else {\n      files.push({\n        suggestedPath: `src/components/${targetComponent.name}.tsx`,\n        type: 'component',\n        reason: 'Selected component (guessed path)',\n      });\n    }\n\n    // Suggest related hook\n    const hookName = targetComponent.name.replace(/Section|Page|Panel|Modal|Wizard/, '');\n    files.push({\n      suggestedPath: `src/hooks/use${hookName}.ts`,\n      type: 'hook',\n      reason: 'Potential data hook for this component',\n    });\n  }\n\n  if (parentComponent?.sourceLocation) {\n    files.push({\n      suggestedPath: parentComponent.sourceLocation.fileName,\n      type: 'component',\n      reason: 'Parent component (from debug source)',\n    });\n  }\n\n  return files;\n}\n\ninterface SourceLocation {\n  fileName: string;\n  lineNumber: number;\n  columnNumber?: number;\n}\n\ninterface ComponentPathItem {\n  name: string;\n  source: string;\n  sourceLocation?: SourceLocation;\n  props?: Record<string, unknown>;\n  state?: unknown[];\n}\n\ninterface ComputedStyles {\n  display: string;\n  position: string;\n  visibility: string;\n  opacity: string;\n  width: string;\n  height: string;\n  padding: string;\n  margin: string;\n  border: string;\n  backgroundColor: string;\n  color: string;\n  fontSize: string;\n  fontWeight: string;\n  cursor: string;\n  pointerEvents: string;\n  overflow: string;\n  zIndex: string;\n}\n\ninterface DOMContext {\n  parents: Array<{\n    tagName: string;\n    id: string;\n    className: string;\n    htmlPreview: string;\n  }>;\n  previousSibling: string | null;\n  nextSibling: string | null;\n  childCount: number;\n  innerHTML: string;\n}\n\ninterface ConsoleEntry {\n  level: 'error' | 'warn';\n  message: string;\n  timestamp: number;\n}\n\ninterface ContextReport {\n  id: string;\n  timestamp: string;\n  url: string;\n  viewport: { width: number; height: number };\n  description?: string;\n  selectedElement: {\n    tagName: string;\n    id: string;\n    className: string;\n    textContent: string;\n    attributes: Record<string, string>;\n    boundingRect: { x: number; y: number; width: number; height: number };\n    selector: string;\n    computedStyles: ComputedStyles;\n    domContext: DOMContext;\n    accessibility: {\n      role: string | null;\n      ariaLabel: string | null;\n      ariaDescribedBy: string | null;\n      ariaDisabled: string | null;\n      tabIndex: string | null;\n    };\n  };\n  componentPath: ComponentPathItem[];\n  appState: Record<string, unknown>;\n  environment: {\n    react?: string;\n    userAgent: string;\n    timestamp: string;\n    url: string;\n  };\n  consoleErrors?: ConsoleEntry[];\n}\n\ninterface ContextScreenshot {\n  reportId: string;\n  data: string;\n}\n\n/**\n * Generate a filename from the report\n */\nfunction generateFilename(report: ContextReport): string {\n  const date = new Date(report.timestamp);\n  const dateStr = date.toISOString().split('T')[0];\n  const timeStr = date.toTimeString().split(' ')[0].replace(/:/g, '');\n\n  let slug = report.selectedElement.id ||\n    report.description?.split(' ')[0] ||\n    report.selectedElement.tagName.toLowerCase();\n  slug = slug.toLowerCase().replace(/[^a-z0-9]+/g, '-').slice(0, 20);\n\n  return `context-${dateStr}-${timeStr}-${slug}`;\n}\n\n/**\n * Format component path as a tree with source info\n */\nfunction formatComponentPath(path: ComponentPathItem[]): string {\n  if (path.length === 0) return 'Unknown';\n\n  return path\n    .map((item, index) => {\n      const indent = '  '.repeat(index);\n      const prefix = index === 0 ? '' : '└── ';\n      const suffix = index === path.length - 1 ? '  ← selected' : '';\n      const source = item.sourceLocation\n        ? ` (${item.sourceLocation.fileName}:${item.sourceLocation.lineNumber})`\n        : '';\n      return `${indent}${prefix}${item.name}${source}${suffix}`;\n    })\n    .join('\\n');\n}\n\n/**\n * Generate markdown content for a report\n */\nfunction generateMarkdown(report: ContextReport, screenshotFilename?: string): string {\n  const el = report.selectedElement;\n  const title = report.description ||\n    `${el.tagName}${el.id ? '#' + el.id : ''}${el.className ? '.' + el.className.split(' ')[0] : ''}`;\n\n  let md = `# Context Report: ${title}\n\n**Captured**: ${new Date(report.timestamp).toLocaleString()}\n**URL**: ${report.url}\n**Viewport**: ${report.viewport.width}x${report.viewport.height}\n\n`;\n\n  if (screenshotFilename) {\n    md += `## Screenshot\n![Screenshot](./screenshots/${screenshotFilename})\n\n`;\n  }\n\n  md += `## User Description\n${report.description || 'No description provided'}\n\n## Selected Element\n\n### Basic Info\n| Property | Value |\n|----------|-------|\n| Tag | \\`${el.tagName}\\` |\n| ID | \\`${el.id || '(none)'}\\` |\n| Classes | \\`${el.className || '(none)'}\\` |\n| Selector | \\`${el.selector}\\` |\n| Position | x: ${el.boundingRect.x}, y: ${el.boundingRect.y} |\n| Size | ${el.boundingRect.width}x${el.boundingRect.height} |\n\n### Text Content\n\\`\\`\\`\n${el.textContent.slice(0, 300)}${el.textContent.length > 300 ? '...' : ''}\n\\`\\`\\`\n\n### Attributes\n\\`\\`\\`json\n${JSON.stringify(el.attributes, null, 2)}\n\\`\\`\\`\n\n### Accessibility\n| Attribute | Value |\n|-----------|-------|\n| role | ${el.accessibility.role || '(none)'} |\n| aria-label | ${el.accessibility.ariaLabel || '(none)'} |\n| aria-describedby | ${el.accessibility.ariaDescribedBy || '(none)'} |\n| aria-disabled | ${el.accessibility.ariaDisabled || '(none)'} |\n| tabindex | ${el.accessibility.tabIndex || '(none)'} |\n\n### Computed Styles\n\\`\\`\\`json\n${JSON.stringify(el.computedStyles, null, 2)}\n\\`\\`\\`\n\n### DOM Context\n\n**Parent Elements:**\n${el.domContext.parents.map((p, i) => `${i + 1}. \\`<${p.tagName.toLowerCase()}${p.id ? '#' + p.id : ''}${p.className ? '.' + p.className.split(' ')[0] : ''}>\\``).join('\\n') || '(none)'}\n\n**Siblings:**\n- Previous: ${el.domContext.previousSibling || '(none)'}\n- Next: ${el.domContext.nextSibling || '(none)'}\n\n**Children:** ${el.domContext.childCount} element(s)\n\n**Inner HTML Preview:**\n\\`\\`\\`html\n${el.domContext.innerHTML.slice(0, 500)}${el.domContext.innerHTML.length > 500 ? '...' : ''}\n\\`\\`\\`\n\n## Component Path\n\\`\\`\\`\n${formatComponentPath(report.componentPath)}\n\\`\\`\\`\n\n`;\n\n  // Add source files section\n  const filesWithSource = report.componentPath.filter(c => c.sourceLocation);\n  if (filesWithSource.length > 0) {\n    md += `### Source Files\n| Component | File | Line |\n|-----------|------|------|\n${filesWithSource.map(c => `| ${c.name} | \\`${c.sourceLocation!.fileName}\\` | ${c.sourceLocation!.lineNumber} |`).join('\\n')}\n\n`;\n  }\n\n  // Add props and state for components that have them (filter out empty)\n  const componentsWithProps = report.componentPath.filter(c => {\n    const hasProps = c.props && Object.keys(c.props).length > 0;\n    const hasState = c.state && c.state.length > 0 &&\n      !c.state.every(s => s === null || s === '[Unserializable]' ||\n        (Array.isArray(s) && s[0] === null));\n    return hasProps || hasState;\n  });\n\n  if (componentsWithProps.length > 0) {\n    md += `### Component Props & State\n\n`;\n    for (const comp of componentsWithProps) {\n      md += `#### ${comp.name}\n`;\n      if (comp.props && Object.keys(comp.props).length > 0) {\n        md += `**Props:**\n\\`\\`\\`json\n${JSON.stringify(comp.props, null, 2)}\n\\`\\`\\`\n\n`;\n      }\n      // Filter out noise from state display\n      const meaningfulState = comp.state?.filter(s =>\n        s !== null && s !== '[Unserializable]' &&\n        !(Array.isArray(s) && s[0] === null)\n      );\n      if (meaningfulState && meaningfulState.length > 0) {\n        md += `**Local State (useState values):**\n\\`\\`\\`json\n${JSON.stringify(meaningfulState, null, 2)}\n\\`\\`\\`\n\n`;\n      }\n    }\n  }\n\n  // Add suggested files section\n  const suggestedFiles = suggestRelatedFiles(report.componentPath);\n  if (suggestedFiles.length > 0) {\n    md += `### Suggested Files to Investigate\n| File | Type | Reason |\n|------|------|--------|\n${suggestedFiles.map(f => `| \\`${f.suggestedPath}\\` | ${f.type} | ${f.reason} |`).join('\\n')}\n\n`;\n  }\n\n  md += `## Application State\n`;\n\n  for (const [manager, state] of Object.entries(report.appState)) {\n    if (state) {\n      md += `\n### ${manager.charAt(0).toUpperCase() + manager.slice(1)}\n\\`\\`\\`json\n${JSON.stringify(state, null, 2)}\n\\`\\`\\`\n`;\n    }\n  }\n\n  // Add console errors if present\n  if (report.consoleErrors && report.consoleErrors.length > 0) {\n    md += `\n## Console Errors & Warnings\n${report.consoleErrors.map(e => `\n### ${e.level.toUpperCase()} (${new Date(e.timestamp).toLocaleTimeString()})\n\\`\\`\\`\n${e.message}\n\\`\\`\\`\n`).join('\\n')}\n`;\n  }\n\n  md += `\n## Environment\n- **React**: ${report.environment.react || 'Unknown'}\n- **User Agent**: ${report.environment.userAgent}\n`;\n\n  return md;\n}\n\n/**\n * Ensure directories exist\n */\nasync function ensureDirectories(): Promise<void> {\n  if (!existsSync(REPORTS_DIR)) {\n    await mkdir(REPORTS_DIR, { recursive: true });\n  }\n  if (!existsSync(SCREENSHOTS_DIR)) {\n    await mkdir(SCREENSHOTS_DIR, { recursive: true });\n  }\n}\n\n/**\n * Parse JSON body from request\n */\nasync function parseBody<T>(req: IncomingMessage): Promise<T> {\n  return new Promise((resolve, reject) => {\n    let body = '';\n    req.on('data', (chunk) => {\n      body += chunk.toString();\n    });\n    req.on('end', () => {\n      try {\n        resolve(JSON.parse(body));\n      } catch {\n        reject(new Error('Invalid JSON'));\n      }\n    });\n    req.on('error', reject);\n  });\n}\n\n/**\n * Send JSON response\n */\nfunction sendJson(res: ServerResponse, status: number, data: unknown): void {\n  res.writeHead(status, {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n  });\n  res.end(JSON.stringify(data));\n}\n\n/**\n * Store for pending reports (waiting for screenshots)\n */\nconst pendingReports = new Map<string, { report: ContextReport; filename: string }>();\n\n/**\n * Handle incoming requests\n */\nasync function handleRequest(req: IncomingMessage, res: ServerResponse): Promise<void> {\n  // Handle CORS preflight\n  if (req.method === 'OPTIONS') {\n    res.writeHead(204, {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    });\n    res.end();\n    return;\n  }\n\n  const url = req.url || '/';\n\n  // Health check endpoint\n  if (req.method === 'GET' && url === '/health') {\n    sendJson(res, 200, { status: 'ok', version: '0.1.0' });\n    return;\n  }\n\n  // Report endpoint\n  if (req.method === 'POST' && url === '/report') {\n    try {\n      await ensureDirectories();\n      const report = await parseBody<ContextReport>(req);\n      const filename = generateFilename(report);\n\n      // Store report, waiting for potential screenshot\n      pendingReports.set(report.id, { report, filename });\n\n      // Set timeout to write report even if no screenshot arrives\n      setTimeout(async () => {\n        const pending = pendingReports.get(report.id);\n        if (pending) {\n          pendingReports.delete(report.id);\n          const markdown = generateMarkdown(pending.report);\n          const filepath = join(REPORTS_DIR, `${pending.filename}.md`);\n          await writeFile(filepath, markdown, 'utf-8');\n          console.log(`[ContextReporter] Saved report: ${filepath}`);\n        }\n      }, 2000);\n\n      sendJson(res, 200, {\n        success: true,\n        id: report.id,\n        filename: `${filename}.md`\n      });\n    } catch (err) {\n      console.error('[ContextReporter] Error saving report:', err);\n      sendJson(res, 500, { error: 'Failed to save report' });\n    }\n    return;\n  }\n\n  // Screenshot endpoint\n  if (req.method === 'POST' && url === '/screenshot') {\n    try {\n      await ensureDirectories();\n      const screenshot = await parseBody<ContextScreenshot>(req);\n\n      // Check if we have a pending report for this screenshot\n      const pending = pendingReports.get(screenshot.reportId);\n\n      // Extract base64 data\n      const base64Data = screenshot.data.replace(/^data:image\\/\\w+;base64,/, '');\n      const buffer = Buffer.from(base64Data, 'base64');\n\n      let filename: string;\n      if (pending) {\n        filename = pending.filename;\n        pendingReports.delete(screenshot.reportId);\n\n        // Write screenshot\n        const screenshotPath = join(SCREENSHOTS_DIR, `${filename}.png`);\n        await writeFile(screenshotPath, buffer);\n        console.log(`[ContextReporter] Saved screenshot: ${screenshotPath}`);\n\n        // Write report with screenshot reference\n        const markdown = generateMarkdown(pending.report, `${filename}.png`);\n        const reportPath = join(REPORTS_DIR, `${filename}.md`);\n        await writeFile(reportPath, markdown, 'utf-8');\n        console.log(`[ContextReporter] Saved report: ${reportPath}`);\n      } else {\n        // No pending report, save screenshot with timestamp\n        filename = `screenshot-${Date.now()}`;\n        const screenshotPath = join(SCREENSHOTS_DIR, `${filename}.png`);\n        await writeFile(screenshotPath, buffer);\n        console.log(`[ContextReporter] Saved orphan screenshot: ${screenshotPath}`);\n      }\n\n      sendJson(res, 200, {\n        success: true,\n        filename: `${filename}.png`\n      });\n    } catch (err) {\n      console.error('[ContextReporter] Error saving screenshot:', err);\n      sendJson(res, 500, { error: 'Failed to save screenshot' });\n    }\n    return;\n  }\n\n  // List reports endpoint\n  if (req.method === 'GET' && url === '/reports') {\n    try {\n      const { readdir, stat } = await import('fs/promises');\n\n      if (!existsSync(REPORTS_DIR)) {\n        sendJson(res, 200, { reports: [] });\n        return;\n      }\n\n      const files = await readdir(REPORTS_DIR);\n      const reports = [];\n\n      for (const file of files) {\n        if (file.endsWith('.md')) {\n          const filepath = join(REPORTS_DIR, file);\n          const stats = await stat(filepath);\n          reports.push({\n            filename: file,\n            created: stats.mtime.toISOString(),\n            size: stats.size,\n          });\n        }\n      }\n\n      // Sort by creation time, newest first\n      reports.sort((a, b) => new Date(b.created).getTime() - new Date(a.created).getTime());\n\n      sendJson(res, 200, { reports });\n    } catch (err) {\n      console.error('[ContextReporter] Error listing reports:', err);\n      sendJson(res, 500, { error: 'Failed to list reports' });\n    }\n    return;\n  }\n\n  // 404 for unknown routes\n  sendJson(res, 404, { error: 'Not found' });\n}\n\n/**\n * Start the server\n */\nexport function startServer(port: number = DEFAULT_PORT): void {\n  const server = createServer((req, res) => {\n    handleRequest(req, res).catch((err) => {\n      console.error('[ContextReporter] Request error:', err);\n      sendJson(res, 500, { error: 'Internal server error' });\n    });\n  });\n\n  server.listen(port, () => {\n    console.log(`\n┌─────────────────────────────────────────────────────────┐\n│  Claude Context Reporter Server                         │\n│                                                         │\n│  Listening on: http://localhost:${port}                  │\n│  Reports saved to: ${REPORTS_DIR}/                            │\n│                                                         │\n│  Endpoints:                                             │\n│    GET  /health     - Health check                      │\n│    POST /report     - Submit context report             │\n│    POST /screenshot - Submit screenshot                 │\n│    GET  /reports    - List saved reports                │\n│                                                         │\n│  Press Ctrl+C to stop                                   │\n└─────────────────────────────────────────────────────────┘\n`);\n  });\n\n  // Handle graceful shutdown\n  process.on('SIGINT', () => {\n    console.log('\\n[ContextReporter] Shutting down...');\n    server.close(() => {\n      process.exit(0);\n    });\n  });\n}\n\n// CLI entry point\nif (require.main === module || process.argv[1]?.includes('context-reporter-server')) {\n  const port = parseInt(process.env.PORT || String(DEFAULT_PORT), 10);\n  startServer(port);\n}\n"]}